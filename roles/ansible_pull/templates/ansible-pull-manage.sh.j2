#!/bin/bash
# Ansible Pull Management Script
# Generated by Ansible - do not edit manually

TIMER_NAME="ansible-pull.timer"
SERVICE_NAME="ansible-pull.service"
LOG_DIR="/var/log/ansible-pull"

case "$1" in
    "status")
        echo "=== Ansible Pull Timer Status ==="
        systemctl status $TIMER_NAME --no-pager
        echo ""
        echo "=== Last Run Information ==="
        systemctl status $SERVICE_NAME --no-pager | head -20
        echo ""
        echo "=== Next Scheduled Run ==="
        systemctl list-timers $TIMER_NAME --no-pager
        ;;
    "run")
        echo "Running ansible-pull immediately..."
        systemctl start $SERVICE_NAME
        echo "Run completed. Check logs with: $0 logs"
        ;;
    "logs")
        #echo "=== Recent Ansible Pull Logs ==="
        #echo "Standard output:"
        #tail -50 $LOG_DIR/ansible-pull.log 2>/dev/null || echo "No standard logs found"
        #echo ""
        #echo "Error output:"
        #tail -20 $LOG_DIR/ansible-pull-error.log 2>/dev/null || echo "No error logs found"
        #echo ""
        #echo "Systemd journal:"
        journalctl -eu $SERVICE_NAME
        ;;
    "enable")
        systemctl enable $TIMER_NAME
        systemctl start $TIMER_NAME
        echo "Ansible pull timer enabled and started"
        ;;
    "disable")
        systemctl disable $TIMER_NAME
        systemctl stop $TIMER_NAME
        echo "Ansible pull timer disabled and stopped"
        ;;
    "commit")
        echo "Repository location: {{ playbook_path }}"
        cd {{ playbook_path }}
        git add .
        git commit -m "$(date --iso-8601='minutes')"
        git push git@github.com:seantwie03/homelab-ansible.git main
        ;;
    *)
        echo "Ansible Pull Management Script"
        echo "Usage: $0 {status|run|logs|enable|disable|edit}"
        echo ""
        echo "Commands:"
        echo "  status   - Show timer status and next run time"
        echo "  run      - Execute ansible-pull immediately"
        echo "  logs     - Show recent ansible-pull logs"
        echo "  enable   - Enable the daily timer"
        echo "  disable  - Disable the daily timer"
        echo "  commit   - Commit all changes to homelab-ansible"
        echo ""
        echo "Current hostname: {{ ansible_hostname }}"
        echo "Playbook: {{ ansible_hostname }}.yml"
        echo "Repository: {{ homelab_ansible_repo_url }}"
        ;;
esac